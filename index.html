<!doctype html><html lang=en><head><meta charset=utf-8><link href=https://seri.tools/style.css rel=stylesheet><title>seri.tools</title><meta name=description><meta content="Dennis Duda" name=author><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#292828 name=theme-color><link href=https://seri.tools/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://seri.tools/rss.xml rel=alternate title=RSS type=application/rss+xml><body bgcolor=#333333 fgcolor=#ded9c9><div class=all><div class=header><header><div class="float-right top-nav"><a href=https://seri.tools/blog>Posts</a> | <a href=https://seri.tools/atom.xml>Atom</a> | <a href=https://seri.tools/rss.xml>RSS</a></div><h1 class=title><a href=https://seri.tools title=seri.tools><strong>seri</strong>.tools</a></h1></header></div><div><main><div class=content><p class=post-date>Posted: 2024-12-03<h1><a href=https://seri.tools/blog/rust9x-1-84/>Rust9x update: Rust 1.84.0-beta</a></h1><div class=center><a title="'Ferrissoft Visual Rust 9X', logo in the style of old Visual Studio logos" href=https://seri.tools/images/rust9x-logo.svg> <img alt="'Ferrissoft Visual Rust 9X', logo in the style of old Visual Studio logos" loading=lazy src=https://seri.tools/images/rust9x-logo.svg width=568> </a></div><p>Another year has passed, oh how the time flies! Time for some Tier 4 target action once again!<p>Rust9x adds support for Windows 9x and older NT-based Windows versions to Rust. See the project wiki on Github: <a href=https://github.com/rust9x/rust/wiki><code>rust9x/rust</code></a>.<h2 id=what-s-new>What's new? <a class=anchor href=#what-s-new>#</a></h2><ul><li>Rebased and reimplemented all fallback code ontop of the ~29600 commits of progress from Rust 1.76 to Rust 1.84-beta<li>The thread parker now only conditionally falls back to the basic, generic one. If supported by the OS, Rust9x will instead choose the <code>NtCreateEvent</code>-based parker or the <code>futex</code>/<code>WaitOnAddress</code>-based one.<li>Better <code>RwLock</code> implementation: Rust9x now uses the upstream <code>queue</code> implementation instead of falling back to a simple <code>Mutex</code>. Similarly, <code>Once</code> also uses the <code>queue</code> implementation now. <ul><li>Since these fallbacks rely on the thread parker only, they should run much faster with the new thread parker fallbacks above, too!</ul><li>Cleaned up the fallback implementations to intrude less on normal non-rust9x Rust <code>windows-msvc</code> targets.</ul><h2 id=what-s-next>What's next? <a class=anchor href=#what-s-next>#</a></h2><ul><li>I'll try to keep up with 1.84 beta branch changes for now.<li>TLS is as bad as ever. Even with the native TLS callback, <code>Drop</code> impls will not run on 9x. I still hope to get to the bottom of this!<li>Windows NT 3.51 is currently broken (failing on <code>_chkstk</code> stack probes when doing stdio, but <em>only</em> then). NT 4 and Windows 95 RTM work fine.<li>Reimplementing the <a href=https://github.com/rust9x/rust/issues/43><code>fileextd.lib</code> fallbacks</a> in Rust will give us a much more complete <code>std::fs</code> implementation on Windows XP (and possibly earlier NT-based systems).<li>The <a href=https://github.com/rust9x/rust/issues/5>fallback</a> from WinSock2 to WinSock 1.1 should actually be pretty simple to implement. It would give us networking support without extra DLL dependencies on Windows 95 RTM and NT 3.51.</ul><p>For now I won't publish a precompiled package (the <code>install</code> scripts are insanely slow on Windows). I'd rather work on the above fixes and leave compiling as an exercise to the reader :^). You can find build instructions in the <a href=https://github.com/rust9x/rust/wiki>Wiki</a>.<p>Please don't expect too much, though - <a href=https://pathofexile2.com/early-access>Path of Exile 2</a> is launching into EA soon, too, so I'll be busy with that!<p>Feel free to hit me up on Discord if you'd like to help out or just chat about Rust9x!</div></main></div><div class=footer><hr><footer>Dennis Duda | <a href=https://github.com/seritools>github/seritools</a><br><a href=https://hachyderm.io/@seri rel=me>hachyderm.io/@seri</a> | <a href=https://bsky.app/profile/seritools.bsky.social>@seritools.bsky.social</a> | <a href=https://x.com/seritools>x/@seritools</a><br> Discord: @seritools | <a href=https://www.linkedin.com/in/seritools/>LinkedIn</a><br><a href=/legal>Legal</a></footer></div></div>